### <a name="_b7urdng99y53"></a>**Название задачи:** Открытие депозитов и накопительных счетов в Интернет-банке (ИБ). MVP. Задача 3
### <a name="_hjk0fkfyohdk"></a>**Автор:** Грязнов М.
### <a name="_uanumrh8zrui"></a>**Дата:** 17.03.2025
### <a name="_3bfxc9a45514"></a>**Функциональные требования**
Депозит/накопительный счет ниже обозначается как Депозит

|**№**|**Требование**|**Действующие лица или системы**|**Use Case**|**Описание**|
| :-: | :- | :- | :- | :- |
|UC1.1||клиент, ИБ|авторизация|1.клиент вводит учетные данные <br/>2. ИБ проверяет учетные данные <br/>3. ИБ предоставляет доступ с соответсвующей ролью |
|UC1.2|F1.2,<br/>F2.1,<br/>F2.2,<br/>F2.3,<br/>F2.4|клиент, ИБ|подача заявки на Депозит/нак. счет|1. клиент видит доступные дерозиты со ставками (предложения) <br/>2. клиент выбирает предложение (доступный депозит и ставку) <br/>3. ИБ отображает заявку на открытие депозита (фиксирует тип и ставку) <br/>4. клиент вводит сумму и нажиамет подтвердит  <br/>5. ИБ направлет СМС для подтверждения, ожидает ввода кода из СМС  <br/>6. клиент получает СМС и вводит код в форму, подтверждает <br/>7. ИБ проверяет код и направляет заявку в обработку, "клиенту отражается Заявка принята в обработку, ожидайте СМС с результатами"  <br/>|
|UC1.3|F4.1|ИБ, АБС|передача заявки на депозит/счет|1. ИБ, после подтверждения клиентом, передает в АБС заявку <br/>2. АБС принимает заявку и предоставляет для обработки Депозитному Менеджеру Бэк-офис <br/>|
|UC1.4| F4.1,<br/>F4.2|Депозитный Менеджер Бэк-офис(ДМ), АБС|Подтверждение депозита/счета (депозит)|1. ДМ видит список поступивших заявок <br/>2. ДМ выбирает заявку для обработки <br/>3. АБС отображает детали заявки Счет, Ставка, Сумма, ФИО и пр. <br/>4. ДМ подтверждает условия <br/>5. Открывает депозит, зачисляет средства <br/>6. АБС отправляет СМС клиенту об открытии депозита <br/>|
|UC2.1|F1.1,<br/>F1.3|Клиент, Сайт|подача заявки|1.Клиент выбирает стандартное предложение <br/>2. Клиент заполняет анкету (ФИО, ТЕЛ) <br/>3. Подтверждает отправку <br/>3.Сайт передает данные для обработки, клиенту отображает сообщение "Ожидайте звонка" <br/>|
|UC2.2|F1.4,<br/>F1.4|Сотрудник Колл-центра(КЦ), CRM, Клиент|Обработка заявления с сайта|1. CRM получает заявление и отображает для звонка <br/>2.КЦ осуществляет звонок клиенту, выясняет доп информацию <br/>3. КЦ подтверждает заявление <br/>4. CRM передает заявку для открытия <br/>|
|UC2.3|F1.6|Сотрудник отделения (СО), клиент, ДМ, АБС|Верификация клиента|1. Клиент приходит в Отделенеие <br/>2.СО проверяет документы <br/>3.СО Взаимодействует с ДМ на предмет ставки <br/>4. СО формирует набор документов и подписывает с клиентом  <br/>5. СО подтверждает в АБС открытие депозита, прикрепляет сканы документов <br/>6. АБС отрывает депозит <br/>|



### <a name="_u8xz25hbrgql"></a>**Нефункциональные требования**
Опишите здесь нефункциональные требования и архитектурно-значимые требования.

|**№**|**Требование**|**Комментарий**|
| :-: | :- | :- |
| U   | Удобство использования (Usability) |              |
| U5.1| интерфейс работы будет максимально удобным для клиента. |              |
| U5.2| придерживаться системы дизайна для приложений, которая принята в компании. |              |
| U5.3| Пользователи при работе должны видеть привычные цвета и брендированные элементы. |              |
| U7.1| Предусмотреть для клиента статус зпявки на открытие депозита | т.к. операция открытия депозита не быстрая - требуется информировать клиента о ее ходе и о том, что заявка не потеряна |
| R   | Надёжность (Reliability)           |              |
| R6.1| Команда АБС утверждает, что база данных системы уже перегружена. Онлайн-подача заявок на большое количество продуктов может поставить под угрозу работоспособность банка.  |              |
| R6.1| При этом все сервисы должны работать 24/7 и быть доступны в 99,9% случаев | поэтому лучше избежать прямой работы интернет-банка с API АБС в новом процессе |
| R6.2| ИБ. в случае сбоев в ЦОД необходимо, чтобы сервисы интернет-банка были доступны и выдерживали требуемую нагрузку. |              |
| R6.3|  Фактически всё работает в одном ЦОД на одной группе серверов. У банка есть резервный ЦОД, в случае сбоя можно переключиться на него |              |
| R6.4| Также лучше предусмотреть равномерное горизонтальное масштабирование и распределение запросов между серверами, приложениями и ЦОД |              |
| R6.5| Но нужно учитывать, что АБС может масштабироваться только вертикально из-за своей базы данных |              |
| P   | Производительность (Performance)   |              |
| P5.1| Отклик по всем операциям должен быть максимально быстрым и занимать миллисекунды  | Сейчас с этим есть проблема: при проведении платежей некоторые справочные данные загружаются больше секунды. |
| S   | Поддерживаемость (Supportability)  |              |
| S2.1| Реализовать отправку СМС собственными силами  | текущий реализован в ядре системы |
| S3.1| как можно больше использовать технологии, которые уже есть в банке. Например, базы данных MS SQL и Oracle.                                |              |
| S3.2| Можно развернуть новые технологии, но необходимо, чтобы они были совместимы с существующими платформами разработки. |              |
| S3.4| желательно, чтобы внутри банка уже была экспертиза |              |
| S3.3| лучше использовать Kafka на перспективу. | текущая версия платформы интернет-банка несовместима с ней |
| S3.4| стоит подумать о переводе интернет-банка на микросервисную архитектуру, но пока только в рамках задачи открытия депозитов |              |
| S3.5| нужно предусмотреть разработку документации для дальнейшего расширения системы |              |
| S7.1| Снизить связанность сервисов | Большая связанность сервисов влияет на сложность производтва и тестированя, может влиять на надежность |
| +R  | + Ограничения (Restricitions)      |              |
| +R1.1 | ФИО и Тел - персональные данные. Требуется защищенный канал     |              |
| +R2.1 | АБС. Доступ к данным по кредитам и депозитам должен быть разделены.  |              |
| +R2.2 | ИБ. Требуется защищенный канал для клиента |              |
| +R7.1 | Хранение и передача прес. данных должно быть защищено  | Вводятся новые взаимодействия, сбор и передача чувствительных данных. Требуется защита согласно локальному законодательству |

### <a name="_qmphm5d6rvi3"></a>**Решение**
Приведите диаграммы контекста и контейнеров в модели C4. Опишите там основные компоненты и интеграции всех элементов решения. 

Также опишите, какой логикой вы руководствовались в ходе принятия решений и выбора технологий. Не забывайте, что необходимо учесть все функциональные и нефункциональные требования.

1. Технология для реализации компонент: .net core - родственная ASP.NET, позволит с небольшим обучением использовать технологию в действющих командах.
2. Реализуем паттерн Душитель - ставим API Gateway на входе, разделяем запросы к Легаси интернет-банку и запросы к сервисам открытия депозитов
3. Создаем 2 отдельных решения "Интернет-банк NEW", "Бэк-офис". Решения разлечаются уровнем доступа пользователей (в идеале в разных подстех), требованиями к хранению и доступу к ифнормации:
   1. "Интернет-банк NEW" в зоне DMZ - только клиенты. Ограничение по доступу к данным. Только авторизованные пользователи, только к своим данным.
   2. "Бэк-офис" в зоне LAN - только для сотрудлников Банка. Можно хранить и обрабатывать перс-данные/коммерческую тайну.
4. Сервисы открытия депозитов реализуем в микросервисной архитектуре, размещаем в Kubernetes 
5. Создаем КЭШ для хранения подготовленных предложений клиенту
6. Убираем сильную связанность сервисов и АБС - создаем асинхронный обмен сообщениями Шину сообщений. 
7. Ставим Адаптер, который умеет взаимодействовать  АБС (знает максимальную возможную нагрузку), который обеспечивает вычетку сообщений из Шины сообщений и передачу в АБС
8. Генерация предложений/ставок - 2 варианта:
   1. Реализовать на стороне АБС - знакомый интерфейс, есть возможность реализхации. Минусы: нагрузка на АБС - может быть критическим фактором
   2. Реализация отдельного сервиса "Калькулятор ставок", реализовать на микросервисной архитектуре. Плюсы: горизонтальное масштабирование. Минусы: новая технология, решение вопросов с доступами/разделением прав.
9.  Учет требований:
   1. Функциональные учтены в UC
   2. Удобство использования (Usability) - в рамках действующего интегрнет банка. Для UI/UX можно использовать наработки легаси Интерне-банка.
   3. Надёжность (Reliability) - выделен отдельный контейнер Датацентр, который может быть масштабирован в доплнительй надацентр с распределением нагрузки в виде балансировщика. Микросервисы должны быть Stateless, кэш на основе Redis позволяет создавать кластер в нескольких датацентрах (как и kafka). 
   4. Поддерживаемость (Supportability) - использовали те технологии, которые близки команде. Знания по k8s, kafka, redis необходимо получить. По .net core дообучить. Важный + это мотивация команды: разработчикам интересно изучать новые, востребованные технологии.
   5.  + Ограничения (Restricitions)  - требвоания к каналам передачи данных. Дополнительных постоянных хранилищ не создается, кроме Kafka - здесь вопрос шифрования данных, также kafka размещается в защищенной зоне Банка - следует проработать с ИБ Банка.

### <a name="_bjrr7veeh80c"></a>**Альтернативы**
Опишите здесь наиболее важные альтернативные решения.

1. Где делать калькулятор ставок АБС или отдельный микросервис
2. .net core можно заменить на java/typescript или иные языки, но с учетом знаний текущей команды это будет потеря времени
3. Вместо Redis использовать MS SQL/Oracle - БД запрещены минцифры для Банков, сложности с кластеризацией/репликацией, уступают по скорости работы. Posgres - может быть алтернативой, но медленнее и сложнее чем Redis в части отказоустойивости
4. kafka - лидер среди систем передачи сообщений, альтернативами могут служить Point-to-Point очереди типа RabbitMQ, но так как эти системы новые для колманды, то выигрывает по перспективности, скорости, масштабируемости kafka
   

**Недостатки, ограничения, риски**

Подробно опишите здесь недостатки, ограничения и риски выбранного решения.
1. Потребует внедрение новых технологий 
   1. Риски изучения технологий (сроки, ошибки)
   2. Привлечение экспертизы на период внедрения
   3. Риски внедрения и сопроводждения (отсутвие опыта)
2. Потребует дополнительного оборудования (доп финансирование)

